(function(n){var d,s=n.Promise,l=Array.prototype.slice,o=Object.prototype.toString,i=function(x){return x&&typeof x.then==="function";},f=function(x){return x;
},t=f,u=function(x){return !!x&&typeof x==="object"&&(o.call(x)==="[object Error]"||x instanceof Error);},g=function(x){return x&&o.call(x)==="[object Object]";
},c=function(x){return u(x)||x===false;},q=function(z,y){var x=y||{};if(g(z)){for(var A in z){if(z.hasOwnProperty(A)){if(A==="mode"&&x[A]){continue;}if(A==="name"&&x.name&&b.promises[x.name]){continue;
}x[A]=z[A];}}}return x;},a=function(x){return Array.isArray(x[0])?x[0]:l.call(x);};if(typeof process==="object"&&process.nextTick){d=process.nextTick;}else{if(typeof setImmediate==="function"){d=setImmediate;
}else{d=function(x){setTimeout(x,0);};}}function h(x,z,y){if(x.isSettled){return;}x.isSettled=true;x.reason=z;x.value=y;if(typeof x.waiting==="function"){x.waiting();
}else{d(function(){if(typeof x.waiting==="function"){x.waiting();}});}}function k(z,x,A,y,B){return function(){var E,C=!z.isResolved,D=false;try{E=C?A(z.reason,z.opts):x(z.value,z.opts);
}catch(F){D=true;B(F);}b.unset(z);z.isOver=true;if(!D){if(!C){y(E);}else{B(E);}}};}function m(y,z){var B=function(C){if(b.isPromise(C)){m(y,C);}else{h(y,null,C);
}},x=function(C){y.isResolved=false;y.isRejected=true;h(y,C);};try{z.then(B,x);}catch(A){x(A);}}function b(y){if(!(this instanceof b)){return new b(y);
}var x=this;x.guid=b.guid++;b.idMap[x.guid]=x;x._promiseState={isResolved:false,isRejected:false,isSettled:false,isOver:false,reason:null,value:null,progressValue:null,waiting:null,opts:null,progressCallback:null,doneCallback:null,failCallback:null};
x._promiseState.opts={};x._promiseState._resolve=b._resolve.bind(x);x._promiseState._reject=b._reject.bind(x);if(typeof y==="function"&&y.length>=1){x._promiseState.opts.mode="init_fire";
try{y(x._promiseState._resolve,x._promiseState._reject);}catch(z){x._promiseState._reject(z);}return x;}x._promiseState.opts.mode="not_init_fire";if(typeof y==="string"){x._promiseState.opts.name=y;
}else{q(y,x.getOptions());}if(x._promiseState.opts.name){b.promises[x._promiseState.opts.name]=b.promises[x._promiseState.opts.name]||x;}}b._resolve=function(x){if(this._promiseState.isResolved){return;
}this._promiseState.isResolved=true;if(b.isPromise(x)){m(this._promiseState,x);}else{h(this._promiseState,null,x);}};b._reject=function(x){if(this._promiseState.isRejected){return;
}this._promiseState.isRejected=true;h(this._promiseState,x);};b.prototype.then=function(x,z){var y=this;if(y.isPending()&&!y._promiseState.waiting){return new b(function(B,C){y._promiseState.waiting=k(y._promiseState,x||y._promiseState.doneCallback||f,z||y._promiseState.failCallback||t,B,C);
});}var A=new Error("Promise.prototype.then: already has waiting or not pending !\n");if(b.debugType==="development"){console.warn(y);throw A;}else{if(!y.isSolving()){y.reject(A);
}}};b.guid=1;b.idMap={};b.promises={};b.getPromise=function(x){return(typeof x==="string"&&b.promises[x])||(typeof x==="number"&&b.idMap[x]);};b.factory=function(x){var y=typeof x!=="function"&&b.getPromise(x);
if(y&&y.isPending()){return y;}return new b(x);};b.defaultResolve=f;b.defaultReject=t;b.isPromise=i;b.isError=u;b.hasError=c;b.noConflict=function(){if(s!==void 0){n.Promise=s;
}return b;};b.debugType="development";b.setDebugType=function(x){b.debugType=x;};b.extend=function(x,y){return q(x,y);};b.error=function(x){throw new Error(x);
};b.logError=function(x){console.log(x);return x;};b.reset=function(x){var y=i(x)?x:b.getPromise(x);if(y&&y.isOver()){q({isResolved:false,isRejected:false,isSettled:false,isOver:false,reason:null,value:null,progressValue:null,},y._promiseState);
y._promiseState.opts.mode="not_init_fire";y._promiseState._resolve=b._resolve.bind(y);y._promiseState._reject=b._reject.bind(y);return true;}return false;
};b.unset=function(x){q({_resolve:null,_reject:null,waiting:null,progressCallback:null,doneCallback:null,failCallback:null},x);};function w(B,x){x=x.reduce(function(E,D,F){E.commitments.push(D[0]);
E.values.push(D[1]);return E;},{commitments:[],values:[]});var y=x.values;var C=x.commitments;var A=[];var z=C.every(function(E,D){if(i(E)){if(B==="resolve"){if(E.isSolving()){A[D]=E;
}else{E.resolve(y[D]);}}else{if(B==="reject"){if(E.isSolving()){A[D]=E;}else{E.reject(y[D]);}}else{if(B==="notify"){if(E.isPending()&&typeof E._promiseState.progress==="function"){E.notify(y[D]);
}else{A[D]=E;}}}}return true;}return false;});return z&&(!A.length?true:A);}function p(y,z,x){if(!~["resolve","reject","notify"].indexOf(y)){return false;
}if(typeof z==="object"&&i(z)&&z.isPending()){z[y](x);return true;}else{if(typeof z==="string"||typeof z==="number"){return p(y,b.getPromise(z),x);}}return false;
}b.resolve=function(y,x){return p("resolve",y,x);};b.reject=function(y,x){return p("reject",y,x);};b.notify=function(y,x){return p("notify",y,x);};b.resolveAll=function(){return w("resolve",l.call(arguments));
};b.rejectAll=function(){return w("reject",l.call(arguments));};b.notifyAll=function(){return w("notify",l.call(arguments));};b.nodeify=function(y,x){return function(C,A,z){var B=new b(function(F,E){var D=function(G,H){if(c(G)){E(G);
}else{if(arguments.length<=2){F(H);}else{F(core_slice.call(arguments,1));}}};if(c(C)){E(C);}else{if(Array.isArray(C)){if(c(C[0])){E(C[0]);}else{y.apply((x||null),C.concat(D));
}}else{y(C,D);}}});if(A||z){return B.then(A,z);}return B;};};function r(y,z,x){if(y.isPending()&&typeof x==="function"){switch(z){case"progress":case"done":case"fail":y._promiseState[z+"Callback"]=y._promiseState[z+"Callback"]||x;
break;}}return y;}b.prototype.progress=function(x){return r(this,"progress",x);};b.prototype.done=function(x){return r(this,"done",x);};b.prototype.fail=function(x){return r(this,"fail",x);
};b.prototype.ready=function(x,y){if(this.isPending()&&!this._promiseState.waiting){return this.then(x,y);}return this;};b.prototype.resolve=function(x){if(this.isPending()){this._promiseState._resolve(x);
}};b.prototype.reject=function(x){if(this.isPending()){this._promiseState._reject(x);}};b.prototype.notify=function(x,y){if(this.isPending()&&typeof this._promiseState.progressCallback==="function"){this._promiseState.progressValue=this._promiseState.progressCallback(x,y);
}};function v(z,y,x){if(z.isSolving()){return;}commitments=a(x);var B=z._promiseState._resolve;var A=z._promiseState._reject;commitments.forEach(function(E,D){if(i(E)){if(y){E.then(B,A);
}else{z=z.then(E._promiseState.progressCallback||b.defaultResolve,b.defaultReject);}}else{if(typeof E==="function"){if(y){var C=E();if((i(C))){C.then(B,A);
}}else{z=z.then(E,b.defaultReject);}}}});return z;}b.prototype.waterFall=function(x){return v(this,false,arguments);};b.prototype.race=function(x){return v(this,true,arguments);
};b.prototype.value=function(){if(this.isResolved()){return this._promiseState.value;}};b.prototype.reason=function(){if(this.isRejected()){return this._promiseState.reason;
}};b.prototype.progressValue=function(){return this._promiseState.progressValue;};b.prototype.toString=function(){return"[object Promise]";};b.prototype.isPending=function(){return !this._promiseState.isSettled&&!this._promiseState.isResolved&&!this._promiseState.isRejected;
};b.prototype.isSolving=function(){return this._promiseState.isRejected||this._promiseState.isResolved;};b.prototype.isSettled=function(){return this._promiseState.isSettled;
};b.prototype.isRejected=function(){return this._promiseState.isSettled&&this._promiseState.isRejected;};b.prototype.isResolved=function(){return this._promiseState.isSettled&&this._promiseState.isResolved;
};b.prototype.isOver=function(){return this._promiseState.isSettled&&this._promiseState.isOver;};b.prototype.getState=function(){return{isSettled:this.isSettled(),isResolved:this.isResolved(),isRejected:this.isRejected(),isPending:this.isPending(),isSolving:this.isSolving(),isOver:this.isOver()};
};b.prototype["catch"]=function(x){return this.then(null,x);};b.prototype.always=function(x){return this.then(x,x);};function e(A,x,C,z){if(!A.isPending()){return A;
}var y=typeof C==="number"&&typeof z==="function"?4:typeof C==="number"?3:2,D=a(l.call(arguments,y)),B={};if(typeof C==="number"){B.timeout=C;}if(typeof z==="function"){B.timeoutCallback=z;
}new b(B).when(D).always(function(E){if(c(E)){return A.reject(E);}var F=x(E);if(!c(F)){A.resolve(F);}else{A.reject(F);}});return A;}function j(x){var y=[];
y.target={hasTruthy:false,hasFalsy:false};x.forEach(function(z){if(!c(z)&&!!z){y.target.hasTruthy=true;y.push(z);}else{y.target.hasFalsy=true;y.push(z);
}});return y;}b.prototype.whenAllResolved=function(y,x){return e.apply(null,[this,function(z){z=j(z);return !z.target.hasFalsy?z.slice():new Error("not all resolved:\n "+z);
}].concat(l.call(arguments)));};b.prototype.whenAnyResolved=function(y,x){return e.apply(null,[this,function(z){z=j(z);return z.target.hasTruthy?z.slice():new Error("no resolved value, all has Error or false:\n "+z);
}].concat(l.call(arguments)));};b.prototype.whenOneResolved=function(z,y,x){return e.apply(null,[this,function(A){var B=j(A);return c(B[z])||!A[z]?new Error("target: ["+z+"] is not resolved:\narr.length: "+B.length+"\n"+B):B.slice();
}].concat(l.call(arguments,1)));};b.prototype.when=function(){if(!arguments.length||this.isSolving()){return;}var F=this,y=[],D=a(arguments),B=D.length,A=B,z=-1,C,G=F.getOptions(),E=G.timeout,x=function(H){if(H!==void 0){y[this.index]=H;
}if(--A<=0){F.resolve(y);}};if(typeof E==="number"&&E>0){setTimeout(function(){var H;if(F.isPending()){if(typeof G.timeoutCallback==="function"){H=G.timeoutCallback(y);
if(G.timeoutCallbackOnlyOnce){G.timeoutCallback=null;}}if(H!==false){F.reject(new Error("Promise.prototype.when: timeout: "+E+"\nresults: "+y));}}},E);
}while(++z<B){C=D[z];if(!C||!i(C)){if(typeof C==="function"){y[z]=C();}else{y[z]=C;}A--;}else{C.always(x.bind({index:z}));}}if(!A){x();}return F;};b.prototype.getOptions=function(x){this._promiseState.opts=this._promiseState.opts||{};
return !x||typeof x!=="string"?this._promiseState.opts:this._promiseState.opts[x];};b.prototype.setOptions=function(y){if(!y||typeof y!=="object"){q({},this.getOptions());
return this;}else{q(y,this.getOptions());}var x=this.getOptions().name;if(x&&!b.promises[x]){b.promises[x]=this;}return this;};if(!!n.window&&n.window===n){if(typeof define==="function"&&define.amd){define(function(){return b;
});}else{n.Promise=b;}}else{if(typeof module!=="undefined"&&module.exports){module.exports=b;}}})(this);